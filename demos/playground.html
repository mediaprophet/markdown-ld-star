<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Markdown-LD* Playground</title>
  <script src="../index.browser.js"></script>
  <link rel="stylesheet" href="../newtheme/style.css">
</head>
<body>
  <canvas id="codeRain"></canvas>
  <h1>Markdown-LD* Playground</h1>
  <p>Explore Markdown-LD* in a cyberpunk matrix of linked data. Parse, convert, and fetch in a holographic web.</p>
  <div style="margin-bottom:1em; background:#23234a; padding:0.7em; border-radius:6px; color:#e6e6ff;">
  <b>Markdown Syntax Ontology:</b>
  <a href="../src/markdown-ontology.ttl" target="_blank">Turtle</a> |
  <a href="../src/markdown-ontology.owl" target="_blank">OWL (sameAs mappings)</a> â€”
  <span title="Standard Markdown">Standard</span>,
  <span title="GitHub Flavored Markdown">GFM</span>,
  <span title="Obsidian Markdown">Obsidian</span>
  <br>
  Use this ontology to annotate or parse Markdown documents by variant and features. The OWL file includes <code>owl:sameAs</code> links to common RDF ontologies.
  </div>

  <div id="errorDisplay" style="color: #ff6666; display: none; margin-bottom: 10px;"></div>
  <div class="demo-container">
    <div class="demo-sidebar">
      <h3>Demo Files</h3>
  <button onclick="loadDemo('demos/schema-org-sample.md')">Schema.org</button>
  <button onclick="loadDemo('demos/rdf-star-sample.md')">RDF-Star</button>
  <button onclick="loadDemo('demos/shacl-sample.md')">SHACL</button>
    </div>
  <div style="flex: 1; min-width: 0;">
  <svg id="graphPreview" style="position: absolute; pointer-events: none; display: none; width: 200px; height: 200px; border: 1px solid #0f0; background: rgba(0,0,0,0.5); box-shadow: 0 0 10px #0f0;"></svg>
      <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'mdToRdf')">Markdown-LD* to RDF</button>
        <button class="tablinks" onclick="openTab(event, 'rdfToMd')">RDF to Markdown-LD*</button>
        <button class="tablinks" onclick="openTab(event, 'fetchUri')">Fetch URI to Markdown-LD*</button>
      </div>

      <div id="mdToRdf" class="tabcontent">
        <h2>Markdown-LD* to RDF</h2>
        <div class="code-editor-container">
          <div class="line-numbers" id="mdLineNumbers"></div>
          <textarea id="mdInput" class="code-editor" placeholder="Enter Markdown-LD* here..." oninput="updateLineNumbers('mdInput','mdLineNumbers')"></textarea>
        </div>
        <div style="margin-top: 0.5em;">
          <select id="outputFormat">
            <option value="turtle">Turtle</option>
            <option value="jsonld">JSON-LD</option>
            <option value="rdfjson">RDF/JSON</option>
            <option value="jsonldstar">JSON-LD*</option>
          </select>
          <button onclick="parseMd()">Parse</button>
        </div>
        <pre id="rdfOutput"></pre>
      </div>

      <div id="rdfToMd" class="tabcontent" style="display: none;">
        <h2>RDF to Markdown-LD*</h2>
        <div class="code-editor-container">
          <div class="line-numbers" id="rdfLineNumbers"></div>
          <textarea id="rdfInput" class="code-editor" placeholder="Enter RDF here (Turtle, JSON-LD, etc.)..." oninput="updateLineNumbers('rdfInput','rdfLineNumbers')"></textarea>
        </div>
        <div style="margin-top: 0.5em;">
          <select id="inputFormat">
            <option value="turtle">Turtle</option>
            <option value="jsonld">JSON-LD</option>
            <option value="rdfjson">RDF/JSON</option>
            <option value="jsonldstar">JSON-LD*</option>
            <option value="n3">N3</option>
            <option value="trig">TriG</option>
          </select>
          <button onclick="convertRdf()">Convert</button>
        </div>
  <pre id="mdOutput" style="overflow-x: auto; max-width: 100%;"></pre>
      </div>

      <div id="fetchUri" class="tabcontent" style="display: none;">
        <h2>Fetch URI to Markdown-LD*</h2>
        <input type="text" id="uriInput" placeholder="Enter RDF URI (e.g., https://example.org/data.ttl)">
        <select id="uriFormat">
          <option value="turtle">Turtle</option>
          <option value="jsonld">JSON-LD</option>
          <option value="rdfjson">RDF/JSON</option>
          <option value="jsonldstar">JSON-LD*</option>
          <option value="n3">N3</option>
          <option value="trig">TriG</option>
        </select>
        <button onclick="fetchAndConvert()">Fetch & Convert</button>
        <div style="margin-top:1em; display:flex; gap:1em; align-items:center;">
          <button id="copyMdBtn" onclick="copyMdSource()" style="display:none;">Copy Source</button>
          <button id="downloadMdBtn" onclick="downloadMdFile()" style="display:none;">Download .md</button>
        </div>
        <pre id="uriOutput" style="overflow-x: auto; max-width: 100%;"></pre>
        <div id="uriOutputRendered" style="background:rgba(0,0,0,0.6); color:#0ff; border-radius:8px; padding:1em; margin-top:1em; display:none;"></div>
      </div>
    </div>
  </div>

  <style>
    .code-editor-container {
      display: flex;
      background: #222233;
      border-radius: 6px;
      border: 1px solid #444;
      box-shadow: 0 2px 8px #0002;
      font-family: 'Fira Mono', 'Consolas', 'Menlo', 'Monaco', monospace;
      margin-bottom: 0.5em;
      min-height: 120px;
      max-width: 100%;
    }
    .line-numbers {
      background: #1a1a2a;
      color: #8888aa;
      padding: 8px 6px 8px 8px;
      text-align: right;
      user-select: none;
      border-right: 1px solid #333355;
      min-width: 2.5em;
      font-size: 1em;
      border-radius: 6px 0 0 6px;
    }
    .code-editor {
      background: transparent;
      color: #e6e6ff;
      border: none;
      outline: none;
      resize: vertical;
      width: 100%;
      min-height: 120px;
      font-family: inherit;
      font-size: 1em;
      padding: 8px;
      border-radius: 0 6px 6px 0;
      box-sizing: border-box;
    }
    .code-editor:focus {
      background: #23234a;
    }
  </style>
  <script>
    function updateLineNumbers(textareaId, lineNumbersId) {
      const textarea = document.getElementById(textareaId);
      const lineNumbers = document.getElementById(lineNumbersId);
      const lines = textarea.value.split('\n').length;
      let html = '';
      for (let i = 1; i <= lines; i++) html += i + '<br>';
      lineNumbers.innerHTML = html;
    }
    // Initialize line numbers on page load
    window.addEventListener('DOMContentLoaded', () => {
      updateLineNumbers('mdInput','mdLineNumbers');
      updateLineNumbers('rdfInput','rdfLineNumbers');
    });
    function openTab(evt, tabName) {
      const tabcontent = document.getElementsByClassName("tabcontent");
      for (let i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      const tablinks = document.getElementsByClassName("tablinks");
      for (let i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }

    function showError(message) {
      const errorDisplay = document.getElementById('errorDisplay');
      errorDisplay.textContent = `Error: ${message}`;
      errorDisplay.style.display = 'block';
    }

    function clearError() {
      const errorDisplay = document.getElementById('errorDisplay');
      errorDisplay.textContent = '';
      errorDisplay.style.display = 'none';
    }

    async function loadDemo(file) {
      clearError();
      try {
  const response = await fetch(`${file}`);
        if (!response.ok) throw new Error('Failed to load demo');
        const content = await response.text();
        document.getElementById('mdInput').value = content;
        openTab({ currentTarget: document.querySelector('.tablinks') }, 'mdToRdf');
        parseMd();
      } catch (e) {
        showError(e.message);
      }
    }

    function parseMd() {
      clearError();
      const input = document.getElementById('mdInput').value;
      const format = document.getElementById('outputFormat').value;
      try {
        const result = MarkdownLDStar.parseMarkdownLD(input, { format });
        const output = typeof result.output === 'object' ? JSON.stringify(result.output, null, 2) : result.output;
        document.getElementById('rdfOutput').textContent = output;
      } catch (e) {
        showError(e.message);
      }
    }

    async function convertRdf() {
      clearError();
      const input = document.getElementById('rdfInput').value;
      const format = document.getElementById('inputFormat').value;
      try {
        const md = await MarkdownLDStar.fromRDFToMarkdownLD(input, format);
        document.getElementById('mdOutput').textContent = md;
      } catch (e) {
        showError(e.message);
      }
    }


    async function fetchAndConvert() {
      clearError();
      const uri = document.getElementById('uriInput').value;
      const format = document.getElementById('uriFormat').value;
      const corsProxy = 'https://corsproxy.io/?';
      try {
        const response = await fetch(corsProxy + encodeURIComponent(uri));
        if (!response.ok) throw new Error('Fetch failed');
        const content = await response.text();
        const md = await MarkdownLDStar.fromRDFToMarkdownLD(content, format);
        document.getElementById('uriOutput').textContent = md;
        // Render as Markdown if it looks like Markdown-LD*
        if (/\[.+\]\{.+\}/.test(md)) {
          document.getElementById('uriOutputRendered').style.display = 'block';
          document.getElementById('uriOutputRendered').innerHTML = marked.parse(md);
          document.getElementById('copyMdBtn').style.display = 'inline-block';
          document.getElementById('downloadMdBtn').style.display = 'inline-block';
        } else {
          document.getElementById('uriOutputRendered').style.display = 'none';
          document.getElementById('copyMdBtn').style.display = 'none';
          document.getElementById('downloadMdBtn').style.display = 'none';
        }
      } catch (e) {
        showError(e.message);
      }
    }

    function copyMdSource() {
      const md = document.getElementById('uriOutput').textContent;
      navigator.clipboard.writeText(md);
    }

    function downloadMdFile() {
      const md = document.getElementById('uriOutput').textContent;
      const blob = new Blob([md], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'output.md';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
    }
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    // Initialize first tab
    document.querySelector('.tablinks').className += ' active';
    document.getElementById('mdToRdf').style.display = 'block';

    // API-like query via URL parameters: ?uri=...&field=...&inputFormat=...&outputFormat=...
    (async function apiQueryFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const uri = params.get('uri');
      const field = params.get('field');
      const inputFormat = params.get('inputFormat');
      let outputFormat = (params.get('outputFormat') || 'markdownld').toLowerCase();
      if (outputFormat === 'markdown-ld-star') outputFormat = 'markdownld';
      if (uri && field) {
        if (!inputFormat) {
          showError('Missing required inputFormat parameter (e.g., inputFormat=turtle, jsonld, etc.)');
          return;
        }
        try {
          const corsProxy = 'https://corsproxy.io/?';
          const response = await fetch(corsProxy + encodeURIComponent(uri));
          if (!response.ok) throw new Error('Fetch failed');
          const content = await response.text();
          // Always convert to JSON-LD for field extraction
          const jsonld = await MarkdownLDStar.fromRDFToMarkdownLD(content, inputFormat);
          const data = typeof jsonld === 'string' ? JSON.parse(jsonld) : jsonld;
          let value = null;
          if (data && data['@graph']) {
            for (const node of data['@graph']) {
              if (node[field]) {
                value = node[field];
                break;
              }
            }
          }
          let output = '';
          if (outputFormat === 'json') {
            output = JSON.stringify({ [field]: value }, null, 2);
          } else if (outputFormat === 'turtle') {
            output = `<#this> ${field} \"${value}\" .`;
          } else if (outputFormat === 'markdownld') {
            output = `[<#this>]{${field}=\"${value}\"}`;
          } else {
            output = `[<#this>]{${field}=\"${value}\"}`;
          }
          document.getElementById('uriOutput').textContent = output;
          openTab({ currentTarget: document.querySelectorAll('.tablinks')[2] }, 'fetchUri');
        } catch (e) {
          showError(e.message);
        }
      }
    })();
  </script>
</body>
</html>